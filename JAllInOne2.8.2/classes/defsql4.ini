ALTER TABLE ITM01_ITEMS ADD BAR_CODE_BAK VARCHAR(1000);
UPDATE ITM01_ITEMS SET BAR_CODE_BAK=BAR_CODE;
ALTER TABLE ITM01_ITEMS DROP COLUMN BAR_CODE;
ALTER TABLE ITM01_ITEMS ADD BAR_CODE VARCHAR(1000);
UPDATE ITM01_ITEMS SET BAR_CODE=BAR_CODE_BAK;
ALTER TABLE ITM01_ITEMS DROP COLUMN BAR_CODE_BAK;

INSERT INTO SYS06_FUNCTIONS(FUNCTION_CODE,PROGRESSIVE_SYS10,IMAGE_NAME,METHOD_NAME,USE_COMPANY_CODE,CAN_DEL)
VALUES('CONN_USERS',3532,'users.gif','getConnectedUsers','N','N');
INSERT INTO SYS18_FUNCTION_LINKS(POS_ORDER,FUNCTION_CODE_SYS06,PROGRESSIVE_HIE01) VALUES(10,'CONN_USERS',102);

INSERT INTO SYS06_FUNCTIONS(FUNCTION_CODE,PROGRESSIVE_SYS10,IMAGE_NAME,METHOD_NAME,USE_COMPANY_CODE,CAN_DEL)
VALUES('REORDER_MIN_STOCK',3542,'open.gif','getReorderFromMinStocks','Y','N');
INSERT INTO SYS18_FUNCTION_LINKS(POS_ORDER,FUNCTION_CODE_SYS06,PROGRESSIVE_HIE01) VALUES(11,'REORDER_MIN_STOCK',42);

INSERT INTO SYS06_FUNCTIONS(FUNCTION_CODE,PROGRESSIVE_SYS10,IMAGE_NAME,METHOD_NAME,USE_COMPANY_CODE,CAN_DEL)
VALUES('ABC',3552,'warehouse.gif','getABC','Y','N');
INSERT INTO SYS18_FUNCTION_LINKS(POS_ORDER,FUNCTION_CODE_SYS06,PROGRESSIVE_HIE01) VALUES(12,'ABC',42);

CREATE TABLE ITM23_VARIANT_MIN_STOCKS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  ITEM_CODE_ITM01 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM06 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM11 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM07 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM12 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM08 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM13 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM09 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM14 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM10 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM15 VARCHAR(20) NOT NULL,
  MIN_STOCK DECIMAL(18,5) NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15),
  INDEX ITM23_FKIndex1(COMPANY_CODE_SYS01, ITEM_CODE_ITM01),
  INDEX ITM23_FKIndex2(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11),
  INDEX ITM23_FKIndex3(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12),
  INDEX ITM23_FKIndex4(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13),
  INDEX ITM23_FKIndex5(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14),
  INDEX ITM23_FKIndex6(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15),
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01)
    REFERENCES ITM01_ITEMS(COMPANY_CODE_SYS01, ITEM_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11)
    REFERENCES ITM16_PRODUCT_VARIANTS_1(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12)
    REFERENCES ITM17_PRODUCT_VARIANTS_2(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13)
    REFERENCES ITM18_PRODUCT_VARIANTS_3(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14)
    REFERENCES ITM19_PRODUCT_VARIANTS_4(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15)
    REFERENCES ITM20_PRODUCT_VARIANTS_5(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE TMP03_ABC (
  REPORT_ID NUMERIC(5) NOT NULL,
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  ITEM_CODE_ITM01 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM06 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM11 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM07 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM12 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM08 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM13 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM09 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM14 VARCHAR(20) NOT NULL,
  VARIANT_TYPE_ITM10 VARCHAR(20) NOT NULL,
  VARIANT_CODE_ITM15 VARCHAR(20) NOT NULL,
  QTY_TYPE CHAR(1) NOT NULL,
  QTY DECIMAL(18,5) NULL,
  INVOICED_GRADE CHAR(1) NULL,
  UNSOLD_GRADE CHAR(1) NULL,
  PRIMARY KEY(REPORT_ID, COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15, QTY_TYPE),
  INDEX TMP03_ABC_FKIndex1(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11),
  INDEX TMP03_ABC_FKIndex2(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12),
  INDEX TMP03_ABC_FKIndex3(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13),
  INDEX TMP03_ABC_FKIndex4(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14),
  INDEX TMP03_ABC_FKIndex5(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15),
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11)
    REFERENCES ITM16_PRODUCT_VARIANTS_1(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM06, VARIANT_CODE_ITM11)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12)
    REFERENCES ITM17_PRODUCT_VARIANTS_2(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM07, VARIANT_CODE_ITM12)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13)
    REFERENCES ITM18_PRODUCT_VARIANTS_3(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM08, VARIANT_CODE_ITM13)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14)
    REFERENCES ITM19_PRODUCT_VARIANTS_4(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM09, VARIANT_CODE_ITM14)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15)
    REFERENCES ITM20_PRODUCT_VARIANTS_5(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, VARIANT_TYPE_ITM10, VARIANT_CODE_ITM15)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);




INSERT INTO SYS07_ROLE_FUNCTIONS(PROGRESSIVE_SYS04,FUNCTION_CODE_SYS06,CAN_INS,CAN_UPD,CAN_DEL)
 SELECT 2,FUNCTION_CODE,'Y','Y','Y' FROM SYS06_FUNCTIONS
 WHERE NOT EXISTS(SELECT * FROM SYS07_ROLE_FUNCTIONS WHERE SYS07_ROLE_FUNCTIONS.FUNCTION_CODE_SYS06=SYS06_FUNCTIONS.FUNCTION_CODE);

INSERT INTO SYS02_COMPANIES_ACCESS(COMPANY_CODE_SYS01,PROGRESSIVE_SYS04,FUNCTION_CODE_SYS06,CAN_INS,CAN_UPD,CAN_DEL)
 SELECT COMPANY_CODE,2,FUNCTION_CODE_SYS06,'Y','Y','Y' FROM SYS07_ROLE_FUNCTIONS,SYS06_FUNCTIONS,SYS01_COMPANIES
 WHERE FUNCTION_CODE_SYS06=FUNCTION_CODE AND USE_COMPANY_CODE='Y' AND SYS01_COMPANIES.ENABLED='Y' AND
 NOT EXISTS(SELECT * FROM SYS02_COMPANIES_ACCESS WHERE COMPANY_CODE_SYS01=COMPANY_CODE AND FUNCTION_CODE_SYS06=FUNCTION_CODE);

insert into ITM23_VARIANT_MIN_STOCKS(COMPANY_CODE_SYS01,ITEM_CODE_ITM01,VARIANT_TYPE_ITM06,VARIANT_TYPE_ITM07,VARIANT_TYPE_ITM08,VARIANT_TYPE_ITM09,VARIANT_TYPE_ITM10,
VARIANT_CODE_ITM11,VARIANT_CODE_ITM12,VARIANT_CODE_ITM13,VARIANT_CODE_ITM14,VARIANT_CODE_ITM15)
select COMPANY_CODE_SYS01,ITEM_CODE,'*','*','*','*','*','*','*','*','*','*' FROM ITM01_ITEMS
WHERE USE_VARIANT_1='N' AND USE_VARIANT_4='N' AND USE_VARIANT_3='N' AND USE_VARIANT_4='N' AND USE_VARIANT_5='N'
