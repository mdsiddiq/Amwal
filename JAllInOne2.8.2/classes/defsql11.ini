UPDATE SYS06_FUNCTIONS SET USE_COMPANY_CODE='Y' WHERE FUNCTION_CODE='REG10';
UPDATE SYS06_FUNCTIONS SET USE_COMPANY_CODE='Y' WHERE FUNCTION_CODE='REG11';

INSERT INTO SYS02_COMPANIES_ACCESS(COMPANY_CODE_SYS01,PROGRESSIVE_SYS04,FUNCTION_CODE_SYS06,CAN_INS,CAN_UPD,CAN_DEL)
 SELECT DISTINCT COMPANY_CODE,2,FUNCTION_CODE_SYS06,'Y','Y','Y' FROM SYS07_ROLE_FUNCTIONS,SYS06_FUNCTIONS,SYS01_COMPANIES
 WHERE FUNCTION_CODE_SYS06=FUNCTION_CODE AND USE_COMPANY_CODE='Y' AND SYS01_COMPANIES.ENABLED='Y' AND
 NOT EXISTS(SELECT * FROM SYS02_COMPANIES_ACCESS WHERE COMPANY_CODE_SYS01=COMPANY_CODE AND FUNCTION_CODE_SYS06=FUNCTION_CODE);


INSERT INTO SYS21_COMPANY_PARAMS(COMPANY_CODE_SYS01,PARAM_CODE,VALUE)
SELECT COMPANY_CODE,'ROUNDING_C_CODE','160.020' FROM SYS01_COMPANIES;

INSERT INTO SYS21_COMPANY_PARAMS(COMPANY_CODE_SYS01,PARAM_CODE,VALUE)
SELECT COMPANY_CODE,'ROUNDING_P_CODE','200.070' FROM SYS01_COMPANIES;

ALTER TABLE DOC19_EXPIRATIONS ADD REAL_ACCOUNT_CODE_ACC02 VARCHAR(20) NULL;

ALTER TABLE DOC19_EXPIRATIONS ADD ROUNDING_ACCOUNT_CODE_ACC02 VARCHAR(20) NULL;


CREATE TABLE REG11_PAY_TYPES (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  PAYMENT_TYPE_CODE VARCHAR(20) NOT NULL,
  PROGRESSIVE_SYS10 NUMERIC(12) NOT NULL,
  ACCOUNT_CODE_ACC02 VARCHAR(20) NULL,
  ENABLED CHAR(1) NOT NULL DEFAULT 'Y',
  PRIMARY KEY(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE),
  FOREIGN KEY(COMPANY_CODE_SYS01,ACCOUNT_CODE_ACC02)
    REFERENCES ACC02_ACCOUNTS(COMPANY_CODE_SYS01,ACCOUNT_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE REG10_PAY_MODES (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  PAYMENT_CODE VARCHAR(20) NOT NULL,
  PAYMENT_TYPE_CODE_REG11 VARCHAR(20) NOT NULL,
  PROGRESSIVE_SYS10 NUMERIC(12) NOT NULL,
  INSTALMENT_NUMBER NUMERIC(4) NOT NULL,
  STEP NUMERIC(2) NOT NULL,
  START_DAY CHAR(1) NOT NULL,
  FIRST_INSTALMENT_DAYS NUMERIC(12) NOT NULL,
  ENABLED CHAR(1) NOT NULL DEFAULT 'Y',
  PRIMARY KEY(COMPANY_CODE_SYS01,PAYMENT_CODE),
  INDEX REG10_Index_1(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE_REG11),
  FOREIGN KEY(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE_REG11)
    REFERENCES REG11_PAY_TYPES(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE REG17_PAY_INSTALMENTS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  PAYMENT_CODE_REG10 VARCHAR(20) NOT NULL,
  RATE_NUMBER NUMERIC(12) NOT NULL,
  PAYMENT_TYPE_CODE_REG11 VARCHAR(20) NOT NULL,
  PERCENTAGE DECIMAL(18,5) NOT NULL,
  INSTALMENT_DAYS NUMERIC(12) NOT NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01,PAYMENT_CODE_REG10, RATE_NUMBER),
  INDEX REG17_FKIndex_1(COMPANY_CODE_SYS01,PAYMENT_CODE_REG10),
  INDEX REG17_FKIndex_2(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE_REG11),
  FOREIGN KEY(COMPANY_CODE_SYS01,PAYMENT_CODE_REG10)
    REFERENCES REG10_PAY_MODES(COMPANY_CODE_SYS01,PAYMENT_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE_REG11)
    REFERENCES REG11_PAY_TYPES(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);


INSERT INTO REG11_PAY_TYPES(COMPANY_CODE_SYS01,PAYMENT_TYPE_CODE,PROGRESSIVE_SYS10,ENABLED) 
SELECT SYS01_COMPANIES.COMPANY_CODE,REG11_PAYMENT_TYPES.PAYMENT_TYPE_CODE,REG11_PAYMENT_TYPES.PROGRESSIVE_SYS10,REG11_PAYMENT_TYPES.ENABLED
FROM REG11_PAYMENT_TYPES,SYS01_COMPANIES;

INSERT INTO REG10_PAY_MODES(COMPANY_CODE_SYS01,PAYMENT_CODE,PAYMENT_TYPE_CODE_REG11,PROGRESSIVE_SYS10,INSTALMENT_NUMBER,STEP,START_DAY,FIRST_INSTALMENT_DAYS,ENABLED)
SELECT SYS01_COMPANIES.COMPANY_CODE,REG10_PAYMENTS.PAYMENT_CODE,REG10_PAYMENTS.PAYMENT_TYPE_CODE_REG11,REG10_PAYMENTS.PROGRESSIVE_SYS10,REG10_PAYMENTS.INSTALMENT_NUMBER,REG10_PAYMENTS.STEP,REG10_PAYMENTS.START_DAY,REG10_PAYMENTS.FIRST_INSTALMENT_DAYS,REG10_PAYMENTS.ENABLED
FROM SYS01_COMPANIES,REG10_PAYMENTS;

INSERT INTO REG17_PAY_INSTALMENTS(COMPANY_CODE_SYS01,PAYMENT_CODE_REG10,RATE_NUMBER,PAYMENT_TYPE_CODE_REG11,PERCENTAGE,INSTALMENT_DAYS)
SELECT SYS01_COMPANIES.COMPANY_CODE,REG17_PAYMENT_INSTALMENTS.PAYMENT_CODE_REG10,REG17_PAYMENT_INSTALMENTS.RATE_NUMBER,REG17_PAYMENT_INSTALMENTS.PAYMENT_TYPE_CODE_REG11,REG17_PAYMENT_INSTALMENTS.PERCENTAGE,REG17_PAYMENT_INSTALMENTS.INSTALMENT_DAYS
FROM SYS01_COMPANIES,REG17_PAYMENT_INSTALMENTS;

DROP TABLE REG17_PAYMENT_INSTALMENTS;
DROP TABLE REG10_PAYMENTS;
DROP TABLE REG11_PAYMENT_TYPES;
