CREATE TABLE ITM24_LEAF_SHEETS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  ROOT_SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, ROOT_SHEET_CODE_ITM25, SHEET_CODE_ITM25),
  INDEX ITM24_FKIndex1(COMPANY_CODE_SYS01, ROOT_SHEET_CODE_ITM25),
  INDEX ITM24_FKIndex2(COMPANY_CODE_SYS01, SHEET_CODE_ITM25),
  FOREIGN KEY(COMPANY_CODE_SYS01, ROOT_SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITM25_SHEETS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  SHEET_CODE VARCHAR(20) NOT NULL,
  PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  IMAGE_NAME VARCHAR(255) NULL,
  LEV NUMERIC(4) NULL,
  S_PROP0 VARCHAR(255) NULL,
  S_PROP1 VARCHAR(255) NULL,
  S_PROP2 VARCHAR(255) NULL,
  S_PROP3 VARCHAR(255) NULL,
  S_PROP4 VARCHAR(255) NULL,
  S_PROP5 VARCHAR(255) NULL,
  S_PROP6 VARCHAR(255) NULL,
  S_PROP7 VARCHAR(255) NULL,
  S_PROP8 VARCHAR(255) NULL,
  S_PROP9 VARCHAR(255) NULL,
  D_PROP0 DATETIME NULL,
  D_PROP1 DATETIME NULL,
  D_PROP2 DATETIME NULL,
  D_PROP3 DATETIME NULL,
  D_PROP4 DATETIME NULL,
  D_PROP5 DATETIME NULL,
  D_PROP6 DATETIME NULL,
  D_PROP7 DATETIME NULL,
  D_PROP8 DATETIME NULL,
  D_PROP9 DATETIME NULL,
  N_PROP0 DECIMAL(18,5) NULL,
  N_PROP1 DECIMAL(18,5) NULL,
  N_PROP2 DECIMAL(18,5) NULL,
  N_PROP3 DECIMAL(18,5) NULL,
  N_PROP4 DECIMAL(18,5) NULL,
  N_PROP5 DECIMAL(18,5) NULL,
  N_PROP6 DECIMAL(18,5) NULL,
  N_PROP7 DECIMAL(18,5) NULL,
  N_PROP8 DECIMAL(18,5) NULL,
  N_PROP9 DECIMAL(18,5) NULL,
  ENABLED CHAR(1) NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, SHEET_CODE),
  INDEX ITM25_FKIndex1(COMPANY_CODE_SYS01),
  FOREIGN KEY(COMPANY_CODE_SYS01)
    REFERENCES SYS01_COMPANIES(COMPANY_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITM26_SHEET_ATTACHED_DOCS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  PROGRESSIVE_HIE01 NUMERIC(12) NOT NULL,
  PROGRESSIVE_DOC14 NUMERIC(12) NOT NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, SHEET_CODE_ITM25, PROGRESSIVE_HIE01, PROGRESSIVE_DOC14),
  INDEX ITM26_FKIndex1(COMPANY_CODE_SYS01, PROGRESSIVE_DOC14, PROGRESSIVE_HIE01),
  INDEX ITM26_FKIndex2(COMPANY_CODE_SYS01, SHEET_CODE_ITM25),
  FOREIGN KEY(COMPANY_CODE_SYS01, PROGRESSIVE_DOC14, PROGRESSIVE_HIE01)
    REFERENCES DOC17_DOCUMENT_LINKS(COMPANY_CODE_SYS01, PROGRESSIVE_DOC14, PROGRESSIVE_HIE01)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITM27_SHEET_SPARE_PARTS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  ITEM_CODE_ITM01 VARCHAR(20) NOT NULL,
  SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01, SHEET_CODE_ITM25),
  INDEX ITM27_FKIndex1(COMPANY_CODE_SYS01, ITEM_CODE_ITM01),
  INDEX ITM27_FKIndex2(COMPANY_CODE_SYS01, SHEET_CODE_ITM25),
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01)
    REFERENCES ITM01_ITEMS(COMPANY_CODE_SYS01, ITEM_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITM28_ROOT_SHEET_SPARE_PARTS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  ROOT_SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  ITEM_CODE_ITM01 VARCHAR(20) NOT NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, ROOT_SHEET_CODE_ITM25, ITEM_CODE_ITM01),
  INDEX ITM28_FKIndex1(COMPANY_CODE_SYS01, ROOT_SHEET_CODE_ITM25),
  INDEX ITM28_FKIndex2(COMPANY_CODE_SYS01, ITEM_CODE_ITM01),
  FOREIGN KEY(COMPANY_CODE_SYS01, ROOT_SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, ITEM_CODE_ITM01)
    REFERENCES ITM01_ITEMS(COMPANY_CODE_SYS01, ITEM_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITM29_SHEETS_LEVELS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  LEV NUMERIC(4) NOT NULL,
  PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP0_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP1_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP2_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP3_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP4_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP5_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP6_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP7_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP8_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  S_PROP9_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP0_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP1_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP2_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP3_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP4_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP5_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP6_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP7_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP8_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  D_PROP9_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP0_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP1_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP2_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP3_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP4_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP5_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP6_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP7_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP8_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  N_PROP9_PROGRESSIVE_SYS10 NUMERIC(12) NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, LEV),
  INDEX ITM29_FKIndex1(COMPANY_CODE_SYS01),
  FOREIGN KEY(COMPANY_CODE_SYS01)
    REFERENCES SYS01_COMPANIES(COMPANY_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITM30_SUBSHEETS (
  COMPANY_CODE_SYS01 VARCHAR(20) NOT NULL,
  PARENT_SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  SHEET_CODE_ITM25 VARCHAR(20) NOT NULL,
  POLYGON VARCHAR(255) NULL,
  PRIMARY KEY(COMPANY_CODE_SYS01, PARENT_SHEET_CODE_ITM25, SHEET_CODE_ITM25),
  INDEX ITM31_FKIndex1(COMPANY_CODE_SYS01, SHEET_CODE_ITM25),
  INDEX ITM31_FKIndex2(COMPANY_CODE_SYS01, PARENT_SHEET_CODE_ITM25),
  FOREIGN KEY(COMPANY_CODE_SYS01, SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(COMPANY_CODE_SYS01, PARENT_SHEET_CODE_ITM25)
    REFERENCES ITM25_SHEETS(COMPANY_CODE_SYS01, SHEET_CODE)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);



ALTER TABLE ITM01_ITEMS ADD SHEET_CODE_ITM25 VARCHAR(20) NULL;
ALTER TABLE ITM01_ITEMS ADD NO_WAREHOUSE_MOV CHAR(1) NULL;
	  
UPDATE ITM01_ITEMS SET NO_WAREHOUSE_MOV='N' WHERE NO_WAREHOUSE_MOV IS NULL;

INSERT INTO SYS11_APPLICATION_PARS(PARAM_CODE,VALUE) VALUES('DOC_NUM_IN_SALE_DOCS','N');


INSERT INTO SYS06_FUNCTIONS(FUNCTION_CODE,PROGRESSIVE_SYS10,IMAGE_NAME,METHOD_NAME,USE_COMPANY_CODE,CAN_DEL)
VALUES('ITM29',3632,'workflow.gif','getSheetLevelsFrame','Y','N');
INSERT INTO SYS18_FUNCTION_LINKS(POS_ORDER,FUNCTION_CODE_SYS06,PROGRESSIVE_HIE01) VALUES(14,'ITM29',22);

INSERT INTO SYS06_FUNCTIONS(FUNCTION_CODE,PROGRESSIVE_SYS10,IMAGE_NAME,METHOD_NAME,USE_COMPANY_CODE,CAN_DEL)
VALUES('SPARE_PART_CAT_DEF',3642,'component.gif','getSparePartsDefFrame','Y','N');
INSERT INTO SYS18_FUNCTION_LINKS(POS_ORDER,FUNCTION_CODE_SYS06,PROGRESSIVE_HIE01) VALUES(15,'SPARE_PART_CAT_DEF',22);

INSERT INTO SYS06_FUNCTIONS(FUNCTION_CODE,PROGRESSIVE_SYS10,IMAGE_NAME,METHOD_NAME,USE_COMPANY_CODE,CAN_DEL)
VALUES('SPARE_PART_CAT',3652,'hierarchies.gif','getSparePartsCatFrame','Y','N');
INSERT INTO SYS18_FUNCTION_LINKS(POS_ORDER,FUNCTION_CODE_SYS06,PROGRESSIVE_HIE01) VALUES(16,'SPARE_PART_CAT',22);

INSERT INTO SYS07_ROLE_FUNCTIONS(PROGRESSIVE_SYS04,FUNCTION_CODE_SYS06,CAN_INS,CAN_UPD,CAN_DEL)
 SELECT 2,FUNCTION_CODE,'Y','Y','Y' FROM SYS06_FUNCTIONS
 WHERE NOT EXISTS(SELECT * FROM SYS07_ROLE_FUNCTIONS WHERE SYS07_ROLE_FUNCTIONS.FUNCTION_CODE_SYS06=SYS06_FUNCTIONS.FUNCTION_CODE);

INSERT INTO SYS02_COMPANIES_ACCESS(COMPANY_CODE_SYS01,PROGRESSIVE_SYS04,FUNCTION_CODE_SYS06,CAN_INS,CAN_UPD,CAN_DEL)
 SELECT COMPANY_CODE,2,FUNCTION_CODE_SYS06,'Y','Y','Y' FROM SYS07_ROLE_FUNCTIONS,SYS06_FUNCTIONS,SYS01_COMPANIES
 WHERE FUNCTION_CODE_SYS06=FUNCTION_CODE AND USE_COMPANY_CODE='Y' AND SYS01_COMPANIES.ENABLED='Y' AND
 NOT EXISTS(SELECT * FROM SYS02_COMPANIES_ACCESS WHERE COMPANY_CODE_SYS01=COMPANY_CODE AND FUNCTION_CODE_SYS06=FUNCTION_CODE);

